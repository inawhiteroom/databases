-- 1. Проанализировать запросы, которые выполнялись на занятии, определить возможные корректировки и/или улучшения (JOIN пока не применять).
-- Затрудняюсь предлогать улучшения)

-- 2. Пусть задан некоторый пользователь. 
-- Из всех друзей этого пользователя найдите человека, который больше всех общался с нашим пользователем.
-- Пользователь 1 id, from_user_id, to_user_id , count(body) as repeats

SELECT COUNT(*) AS repetitions, from_user_id
from (select from_user_id, to_user_id  from messages as m
join users as u
	on u.id = m.to_user_id where to_user_id = 1) as mes group by from_user_id HAVING repetitions > 1;

-- 3. Подсчитать общее количество лайков, которые получили 10 самых молодых пользователей.

select SUM(likepage) from (SELECT * FROM (select profile_id, likepage, timestampdiff(year, birthday, now()) as birthday from users
join likes_posts 
	on users.id = likes_posts.profile_id) AS likes GROUP BY profile_id order by birthday limit 10) as total_likes;

-- 4. Определить кто больше поставил лайков (всего) - мужчины или женщины?

select COUNT(*) AS how_much, gender from (select profile_id, gender from likes_posts as li 
join users as u 
	on u.id = li.profile_id where gender = 'm') as men;
select COUNT(*) AS how_much, gender from (select profile_id, gender from likes_posts as li 
join users as u 
	on u.id = li.profile_id where gender = 'f') as women;
    
-- 5. Найти 10 пользователей, которые проявляют наименьшую активность в использовании социальной сети.

SELECT COUNT(*) AS repetitions, user_id
from (select user_id, body from users as u
left join posts as p 
	on u.id = p.user_id) as activ group by user_id HAVING repetitions >= 0 order by repetitions limit 10;